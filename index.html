<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EtymoFlow - è¯æ±‡å…¨æ ˆå­¦ä¹ ç³»ç»Ÿ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; transition: all 0.3s ease; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(226, 232, 240, 0.8); }
        .dark-mode { background-color: #0f172a; color: #f8fafc; }
        .dark-mode .glass-card { background: rgba(30, 41, 59, 0.7); border-color: rgba(71, 85, 105, 0.5); color: #f8fafc; }
    </style>
</head>
<body :class="{ 'dark-mode': isDarkMode }" id="app">
    <nav class="p-4 sticky top-0 z-50 glass-card flex justify-between items-center shadow-sm">
        <h1 class="font-bold text-xl tracking-tight text-indigo-600 dark:text-indigo-400">EtymoFlow</h1>
        <div class="flex gap-3">
            <button @click="isDarkMode = !isDarkMode" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                {{ isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™' }}
            </button>
            <button v-if="view !== 'home'" @click="view = 'home'" class="text-sm font-medium px-4 py-2 bg-indigo-500 text-white rounded-lg">è¿”å›é¦–é¡µ</button>
        </div>
    </nav>

    <main class="max-w-md mx-auto p-6">
        <div v-if="view === 'home'" class="animate__animated animate__fadeIn">
            <h2 class="text-2xl font-bold mb-6">ä½ å¥½ Nova, <br><span class="text-gray-500 text-lg font-normal">å‡†å¤‡å¥½ä»Šå¤©çš„æŒ‘æˆ˜äº†å—ï¼Ÿ</span></h2>
            
            <div class="grid gap-4">
                <section>
                    <h3 class="text-sm font-semibold uppercase text-gray-400 mb-2">å­¦ä¹ æ¨¡å¼ (Study)</h3>
                    <div class="grid grid-cols-1 gap-3">
                        <button v-for="l in lessons" @click="startLesson(l)" class="glass-card p-4 rounded-2xl flex justify-between items-center hover:scale-[1.02] transition-transform">
                            <span>{{ l.title }}</span>
                            <span class="text-xs bg-indigo-100 text-indigo-600 px-2 py-1 rounded">5 è¯</span>
                        </button>
                    </div>
                </section>

                <section class="mt-6">
                    <h3 class="text-sm font-semibold uppercase text-gray-400 mb-2">æµ‹è¯•æ¨¡å¼ (Quiz)</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button v-for="l in lessons" @click="startQuiz(l)" class="bg-emerald-500 text-white p-3 rounded-xl text-sm font-medium">
                            {{ l.id.toUpperCase() }} æµ‹è¯•
                        </button>
                        <button @click="startFullQuiz" class="col-span-2 bg-orange-500 text-white p-4 rounded-xl font-bold shadow-lg shadow-orange-200 dark:shadow-none">
                            ğŸš€ æ€»è¯¾ç¨‹è¯æµ‹ (Final Exam)
                        </button>
                    </div>
                </section>
            </div>
        </div>

        <div v-if="view === 'study'" class="animate__animated animate__slideInRight">
            <div class="mb-4 flex items-center justify-between">
                <span class="text-sm font-bold text-indigo-500">{{ currentLesson.title }}</span>
                <span class="text-xs text-gray-400">{{ currentIndex + 1 }} / {{ currentLessonWords.length }}</span>
            </div>
            
            <div class="glass-card p-8 rounded-3xl shadow-xl text-center mb-8">
                <div class="text-xs text-indigo-400 font-mono mb-2">Logic: {{ currentWordGroupLogic }}</div>
                <h2 class="text-4xl font-bold mb-2">{{ currentWord.word }}</h2>
                <p class="text-gray-500 mb-4">{{ currentWord.phonetic }} <button @click="playTTS(currentWord.word)" class="ml-2 text-indigo-500">ğŸ”Š</button></p>
                <div class="h-px bg-gray-100 w-full my-4"></div>
                <p class="text-lg font-medium">{{ currentWord.pos }} {{ currentWord.meaning }}</p>
            </div>

            <div class="flex gap-4">
                <button @click="prevWord" :disabled="currentIndex === 0" class="flex-1 py-4 rounded-2xl bg-gray-100 dark:bg-gray-800 disabled:opacity-30">ä¸Šä¸€ä¸ª</button>
                <button @click="nextWord" class="flex-1 py-4 rounded-2xl bg-indigo-600 text-white font-bold">{{ currentIndex === currentLessonWords.length - 1 ? 'å®Œæˆ' : 'ä¸‹ä¸€ä¸ª' }}</button>
            </div>
        </div>

        <div v-if="view === 'quiz'" class="animate__animated animate__fadeIn">
            <div class="mb-6">
                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div class="h-full bg-orange-500 transition-all" :style="{width: (quizIndex/quizWords.length)*100 + '%'}"></div>
                </div>
            </div>

            <div v-if="!quizFinished">
                <div class="text-center mb-8">
                    <p class="text-gray-400 mb-2">æ ¹æ®é‡Šä¹‰æ‹¼å†™å•è¯</p>
                    <button @click="playTTS(quizWords[quizIndex].word)" class="text-4xl mb-4 p-4 bg-orange-100 rounded-full">ğŸ”Š</button>
                    <h3 class="text-xl font-bold">{{ quizWords[quizIndex].meaning }}</h3>
                    <p class="text-sm text-gray-400 mt-2">è¯ç¼€é€»è¾‘: {{ quizWords[quizIndex].logic }}</p>
                </div>

                <input type="text" v-model="quizInput" @keyup.enter="submitAnswer" placeholder="è¾“å…¥å•è¯..." class="w-full p-4 rounded-xl border-2 border-indigo-200 focus:border-indigo-500 outline-none text-center text-xl font-mono mb-4 dark:bg-gray-800">
                <button @click="submitAnswer" class="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold">ç¡®è®¤æäº¤</button>
            </div>

            <div v-else class="text-center">
                <div class="text-6xl mb-4">ğŸ†</div>
                <h2 class="text-2xl font-bold mb-2">æµ‹è¯•å®Œæˆ!</h2>
                <p class="text-gray-500 mb-6">ä½ çš„å¾—åˆ†: {{ quizScore }} / {{ quizWords.length }}</p>
                <button @click="view = 'home'" class="w-full py-4 bg-gray-800 text-white rounded-xl">å›åˆ°ä¸»é¡µ</button>
            </div>
        </div>
    </main>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                const view = ref('home');
                const isDarkMode = ref(false);
                const currentIndex = ref(0);
                const currentLesson = ref(null);
                
                // æµ‹è¯•ç›¸å…³
                const quizWords = ref([]);
                const quizIndex = ref(0);
                const quizInput = ref('');
                const quizScore = ref(0);
                const quizFinished = ref(false);

                // æ•°æ®æº
                const lessons = [
                    {
                        id: 'lesson1',
                        title: 'Lesson 1 Â· åè¯/å½¢å®¹è¯åç¼€ (de-)',
                        groups: [{
                            logic: "ä½¿æˆä¸ºï¼›åŠ å¼º",
                            items: [
                                {word:"depict", phonetic:"dÉªËˆpÉªkt", pos:"vt.", meaning:"æè¿°ï¼›æç”»"},
                                {word:"define", phonetic:"dÉªËˆfaÉªn", pos:"vt.", meaning:"å®šä¹‰ï¼›ä½¿æ˜ç¡®"},
                                {word:"definite", phonetic:"ËˆdefÉªnÉªt", pos:"adj.", meaning:"ä¸€å®šçš„ï¼›ç¡®åˆ‡çš„"},
                                {word:"definition", phonetic:"ËŒdefÉªËˆnÉªÊƒ(É™)n", pos:"n.", meaning:"å®šä¹‰ï¼›æ¸…æ™°åº¦"}
                            ]
                        }]
                    },
                    {
                        id: 'lesson2',
                        title: 'Lesson 2 Â· å¦å®šå‰ç¼€ (un-)',
                        groups: [{
                            logic: "è¡¨ç¤ºå¦å®š/ç›¸å",
                            items: [
                                {word:"unusual", phonetic:"ÊŒnËˆjuËÊ’uÉ™l", pos:"adj.", meaning:"å¼‚å¸¸çš„"},
                                {word:"unable", phonetic:"ÊŒnËˆeÉªbl", pos:"adj.", meaning:"ä¸èƒ½çš„"}
                            ]
                        }]
                    },
                    // è¿™é‡Œå¯ä»¥ç»§ç»­æ·»åŠ  Lesson 3, 4, 5...
                ];

                const currentLessonWords = computed(() => {
                    if (!currentLesson.ref) return []; // ç®€åŒ–å¤„ç†
                });

                // è¾…åŠ©å‡½æ•°ï¼šæ‰å¹³åŒ–å•è¯
                const flattenWords = (lesson) => {
                    let words = [];
                    lesson.groups.forEach(g => {
                        g.items.forEach(i => words.push({...i, logic: g.logic}));
                    });
                    return words;
                };

                const allWords = computed(() => lessons.flatMap(l => flattenWords(l)));

                // å­¦ä¹ é€»è¾‘
                const startLesson = (lesson) => {
                    currentLesson.value = lesson;
                    currentLessonWords.value = flattenWords(lesson);
                    currentIndex.value = 0;
                    view.value = 'study';
                };

                const nextWord = () => {
                    if (currentIndex.value < currentLessonWords.value.length - 1) {
                        currentIndex.value++;
                    } else {
                        view.value = 'home';
                    }
                };

                const prevWord = () => {
                    if (currentIndex.value > 0) currentIndex.value--;
                };

                // æµ‹è¯•é€»è¾‘
                const startQuiz = (lesson) => {
                    quizWords.value = flattenWords(lesson).sort(() => Math.random() - 0.5);
                    initQuiz();
                };

                const startFullQuiz = () => {
                    quizWords.value = allWords.value.sort(() => Math.random() - 0.5);
                    initQuiz();
                };

                const initQuiz = () => {
                    quizIndex.value = 0;
                    quizScore.value = 0;
                    quizInput.value = '';
                    quizFinished.value = false;
                    view.value = 'quiz';
                };

                const submitAnswer = () => {
                    if (quizInput.value.trim().toLowerCase() === quizWords.value[quizIndex.value].word.toLowerCase()) {
                        quizScore.value++;
                    }
                    if (quizIndex.value < quizWords.value.length - 1) {
                        quizIndex.value++;
                        quizInput.value = '';
                    } else {
                        quizFinished.value = true;
                    }
                };

                // æ ¸å¿ƒ TTSï¼šè‹±éŸ³è®¾ç½®
                const playTTS = (text) => {
                    const synth = window.speechSynthesis;
                    const utter = new SpeechSynthesisUtterance(text);
                    const voices = synth.getVoices();
                    // å¯»æ‰¾åŒ…å« GB æˆ– UK çš„å£°éŸ³
                    const gbVoice = voices.find(v => v.lang.includes('GB') || v.lang.includes('UK'));
                    if (gbVoice) utter.voice = gbVoice;
                    utter.lang = 'en-GB';
                    synth.speak(utter);
                };

                return {
                    view, isDarkMode, lessons, currentLesson, currentIndex, 
                    currentWord: computed(() => currentLessonWords.value[currentIndex.value]),
                    currentWordGroupLogic: computed(() => currentLessonWords.value[currentIndex.value].logic),
                    currentLessonWords, startLesson, nextWord, prevWord, playTTS,
                    quizWords, quizIndex, quizInput, quizScore, quizFinished,
                    startQuiz, startFullQuiz, submitAnswer
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
